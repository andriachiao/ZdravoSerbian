<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Serbian Cyrillic ↔ Latin • Word Linking Game</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", "Noto Sans Serbian", "Noto Sans Extended", Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; padding: 20px; flex-direction: column; align-items: center; }
  .game { background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.08); padding: 20px; max-width: 640px; width: 100%; }
  .top { display:flex; gap:10px; align-items:center; }
  .toggle { display:inline-flex; border:1px solid #e0e3e7; border-radius: 12px; overflow:hidden }
  .toggle button{ padding:8px 12px; border:0; background:transparent; cursor:pointer; font-weight:600 }
  .toggle button.active{ background:#2e6cff; color:#fff }
  .intro { font-size: 14px; color:#555; margin: 8px 0 12px }
  .prompt-word { font-size: 42px; font-weight:800; text-align:center; margin: 10px 0 6px }
  .sub { text-align:center; color:#6b7280; margin-bottom: 6px }
  .slots { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin: 14px 0 }
  .slot { min-width:36px; min-height:42px; border:2px dashed #e5e7eb; border-radius:10px; display:flex; align-items:center; justify-content:center; padding:4px 8px; font-size:22px; font-weight:700; }
  .slot.filled{ border-style:solid; border-color:#c7f9cc; background:#edfff1 }
  .options { display:grid; grid-template-columns: repeat(2, minmax(180px,1fr)); gap:10px }
  .opt { border:1px solid #e0e3e7; border-radius:12px; padding:10px 12px; font-weight:700; cursor:pointer; text-align:center }
  .opt.correct{ background:#d4edda; border-color:#28a745 }
  .opt.wrong{ background:#f8d7da; border-color:#dc3545 }
  .row { display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:12px }
  .btn{ padding:9px 12px; border-radius:12px; border:1px solid #e0e3e7; background:#fff; cursor:pointer; font-weight:600 }
  .btn.primary{ background:#2e6cff; color:#fff; border-color:#2e6cff }
  .muted{ color:#6b7280 }
  .meaning{ margin-top:8px; text-align:center; font-size:14px; color:#374151; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; display:none }
  .signature { margin-top: 14px; font-size: 12px; color: #999; }
</style>
</head>
<body>
<div class="game">
  <div class="top">
    <div class="toggle" id="modeToggle">
      <button data-mode="c2l" class="active">Ћ → Ć</button>
      <button data-mode="l2c">Ć → Ћ</button>
    </div>
    <div class="muted">Connect the word letter-by-letter.</div>
  </div>
  <div class="intro">
    <b>How to play:</b> Click the correct letter for each step until the full transliteration is built.
  </div>
  <div class="prompt-word" id="prompt"></div>
  <div class="sub" id="progressText"></div>
  <div class="slots" id="slots"></div>
  <div class="options" id="options"></div>
  <div class="meaning" id="meaning"></div>
  <div class="row">
    <div class="muted">Score: <span id="score">0</span> • Streak: <span id="streak">0</span></div>
    <div>
      <button class="btn" id="undoBtn">Undo</button>
      <button class="btn primary" id="nextBtn">Next</button>
    </div>
  </div>
</div>
<div class="signature">@ZdravoSerbian</div>
<script>
// --- Alphabet mapping ---
const ALPH = [
  {c:"А", l:"A"},{c:"Б", l:"B"},{c:"В", l:"V"},{c:"Г", l:"G"},{c:"Д", l:"D"},
  {c:"Ђ", l:"Đ"},{c:"Е", l:"E"},{c:"Ж", l:"Ž"},{c:"З", l:"Z"},{c:"И", l:"I"},
  {c:"Ј", l:"J"},{c:"К", l:"K"},{c:"Л", l:"L"},{c:"Љ", l:"Lj"},{c:"М", l:"M"},
  {c:"Н", l:"N"},{c:"Њ", l:"Nj"},{c:"О", l:"O"},{c:"П", l:"P"},{c:"Р", l:"R"},
  {c:"С", l:"S"},{c:"Т", l:"T"},{c:"Ћ", l:"Ć"},{c:"У", l:"U"},{c:"Ф", l:"F"},
  {c:"Х", l:"H"},{c:"Ц", l:"C"},{c:"Ч", l:"Č"},{c:"Џ", l:"Dž"},{c:"Ш", l:"Š"}
];

// Words in both scripts + brief meaning
const WORDS = [
  ["Ана","Ana","Ana (name)"],["Београд","Beograd","Belgrade"],["Вино","Vino","wine"],["Гора","Gora","mountain"],["Дунав","Dunav","Danube"],
  ["Ђак","Đak","pupil / student"],["Европа","Evropa","Europe"],["Жена","Žena","woman"],["Злато","Zlato","gold"],["Игра","Igra","game"],
  ["Јабука","Jabuka","apple"],["Кућа","Kuća","house"],["Лето","Leto","summer"],["Љубав","Ljubav","love"],["Море","More","sea"],
  ["Новац","Novac","money"],["Њива","Njiva","(crop) field"],["Око","Oko","eye"],["Пиво","Pivo","beer"],["Река","Reka","river"],
  ["Село","Selo","village"],["Торта","Torta","cake"],["Ћуп","Ćup","jar"],["Улица","Ulica","street"],["Фрула","Frula","flute"],
  ["Хлеб","Hleb","bread"],["Цвеће","Cveće","flowers"],["Чај","Čaj","tea"],["Џем","Džem","jam"],["Школа","Škola","school"]
];

// Utilities
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a }
function tokLatin(s){
  const out=[]; let i=0;
  while(i<s.length){
    const a=s[i], b=s[i+1];
    if(i+1<s.length){
      const two=a+b;
      if(/^(Lj|NJ|LJ|Nj|lj|nj)$/.test(two)){ out.push(two); i+=2; continue; }
      if(/^(Dž|DŽ|dž)$/.test(two)){ out.push(two); i+=2; continue; }
    }
    out.push(a); i+=1;
  }
  return out;
}
function tokCyr(s){ return Array.from(s); }
function eqToken(a,b){ return a.toLowerCase()===b.toLowerCase(); }
function tokensToString(ts){ return ts.join(""); }
function buildOptions(targetToken, mode){
  if(!targetToken) return [];
  const pool = mode==='c2l' ? ALPH.map(p=>p.l) : ALPH.map(p=>p.c);
  const set=new Set([targetToken]);
  while(set.size<4){ set.add(pool[Math.floor(Math.random()*pool.length)]); }
  return shuffle([...set]);
}

// State & elements
let mode='c2l';
let indexWord=0, score=0, streak=0;
let promptTokens=[], answerTokens=[], cursor=0, currentMeaning="";
const elPrompt=document.getElementById('prompt');
const elSlots=document.getElementById('slots');
const elOptions=document.getElementById('options');
const elScore=document.getElementById('score');
const elStreak=document.getElementById('streak');
const elNext=document.getElementById('nextBtn');
const elUndo=document.getElementById('undoBtn');
const modeToggle=document.getElementById('modeToggle');
const progressText=document.getElementById('progressText');
const elMeaning=document.getElementById('meaning');

function setupWord(){
  const [wc, wl, en] = WORDS[indexWord];
  currentMeaning = en || '';
  if(mode==='c2l'){
    promptTokens = tokCyr(wc);      // fixed case
    answerTokens = tokLatin(wl);    // fixed case
  } else {
    promptTokens = tokLatin(wl);
    answerTokens = tokCyr(wc);
  }
  cursor=0;
  elMeaning.style.display='none';
  elMeaning.textContent='';
  render();
}

function render(){
  elPrompt.textContent = tokensToString(promptTokens);
  // slots
  elSlots.innerHTML='';
  for(let i=0;i<answerTokens.length;i++){
    const d=document.createElement('div');
    d.className='slot'+(i<cursor?' filled':'');
    d.textContent = i<cursor ? answerTokens[i] : '';
    elSlots.appendChild(d);
  }
  // options
  elOptions.innerHTML='';
  const need = answerTokens[cursor];
  progressText.textContent = `Letter ${cursor+1} of ${answerTokens.length}`;
  const opts = buildOptions(need, mode);
  opts.forEach(val=>{
    const b=document.createElement('button');
    b.className='opt'; b.textContent=val;
    b.onclick=()=>pick(val);
    elOptions.appendChild(b);
  });
  elScore.textContent=score; elStreak.textContent=streak;
}

function pick(val){
  const need = answerTokens[cursor];
  const btn=Array.from(document.querySelectorAll('.opt')).find(b=>b.textContent===val);
  if(eqToken(val, need)){
    btn.classList.add('correct');
    score+=2; streak++; cursor++;
    const slot=elSlots.children[cursor-1];
    if(slot){ slot.classList.add('filled'); slot.textContent=need; }
    if(cursor>=answerTokens.length){
      score+=5;
      const builtPrompt = tokensToString(promptTokens);
      const builtAnswer = tokensToString(answerTokens);
      const surface = (mode==='c2l') ? `${builtPrompt} — ${builtAnswer}` : `${builtAnswer} — ${builtPrompt}`;
      elMeaning.textContent = surface + (currentMeaning? ` • ${currentMeaning}` : '');
      elMeaning.style.display='block';
    } else {
      setTimeout(()=>render(), 180);
    }
  } else {
    btn.classList.add('wrong');
    streak=0; score=Math.max(0, score-1);
    elScore.textContent=score; elStreak.textContent=streak;
  }
}

function undo(){ if(cursor>0){ cursor--; render(); } }
function nextWord(){ indexWord=(indexWord+1)%WORDS.length; setupWord(); }

elNext.addEventListener('click', nextWord);
elUndo.addEventListener('click', undo);
modeToggle.addEventListener('click', (e)=>{
  if(e.target.matches('button[data-mode]')){
    mode = e.target.dataset.mode;
    modeToggle.querySelectorAll('button').forEach(b=>b.classList.toggle('active', b.dataset.mode===mode));
    setupWord();
  }
});
window.addEventListener('keydown',(e)=>{ if(e.key==='Enter') nextWord(); else if(e.key==='Backspace'){ e.preventDefault(); undo(); }});

// init
shuffle(WORDS);
setupWord();
</script>
</body>
</html>
